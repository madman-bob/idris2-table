. ../testutils.sh

basicTest ExampleTable.idr << EOF
    show students

    column "name" students
    column "age" students
    column "grade" students

    :let studentsWithFinal : Table [<"name" :! String, "age" :! Nat, "favorite color" :! String, "final" :! Nat]
    :let studentsWithFinal = addColumn "final" [<87, 85, 77] students
    show studentsWithFinal

    column "name" studentsWithFinal
    column "age" studentsWithFinal
    column "final" studentsWithFinal

    :let studentsReplaceGrade : Table [<"name" :! String, "age" :! Nat, "favorite color" :! String, "grade" :! String]
    :let studentsReplaceGrade = replaceColumn "final" "grade" grade studentsWithFinal
    show studentsReplaceGrade

    :let studentsCastAge : Table [<"name" :! String, "age" :! Int, "favorite color" :! String]
    :let studentsCastAge = updateColumn "age" cast students
    show studentsCastAge

    :let studentsWithGrade : Table [<"name" :! String, "age" :! Nat, "favorite color" :! String, "final" :! Nat, "grade" :! String]
    :let studentsWithGrade = buildColumn "grade" (\[<_, _, _, final] => grade final) studentsWithFinal
    show studentsWithGrade

    show $ dropColumn "age" students
    show $ dropColumn "favorite color" students
    show $ dropColumn "grade" students

    allColumns (drop StudentSchema "age")
    allColumns StudentSchema
EOF
